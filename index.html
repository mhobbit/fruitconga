<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <script src="scripts/phaser.min.js"></script>
    </head>
    <body>
    	<script type="text/javascript">
		    window.onload = function() {
		        var game = new Phaser.Game(640, 480, Phaser.CANVAS, '', { preload: preload, create: create, update: update });

		        var size = 34;
		        var baseheight = 120;
		        var basewidth = 140;

		        var grilla = [];
		        var grillaSprites = [];

		        function preload () {
		            game.load.image('manzana', 'img/manzana.jpg');
		            game.load.image('naranja', 'img/naranja.jpg');
		            game.load.image('platano', 'img/platano.jpg');
		        }

		        function create () {
		        	var temp;
		        	for(i = 0; i < 10; i++){
		        		for(j = 0; j < 10; j++){
		        			temp = grilla[(10 * i) + j] = parseInt(Math.random() * 3);
		        			if(temp == 0)
		        				grillaSprites[(10 * i) + j] = game.add.sprite((i * size) + basewidth, (j * size) + baseheight, 'manzana');
		        			else if(temp == 1)
		        				grillaSprites[(10 * i) + j] = game.add.sprite((i * size) + basewidth, (j * size) + baseheight, 'naranja');
		        			else if(temp == 2)
		        				grillaSprites[(10 * i) + j] = game.add.sprite((i * size) + basewidth, (j * size) + baseheight, 'platano');
		        			grillaSprites[(10 * i) + j].scale.setTo(.08, .08);
		        			grillaSprites[(10 * i) + j].inputEnabled = true;
		        			grillaSprites[(10 * i) + j].events.onInputDown.add(ClickHandler, grillaSprites[(10 * i) + j]);
		        		}
		        	}
		        }

		        function update() {
		        }

		        function ClickHandler(eve){
		        	var cola = [];
		        	var iguales = [];
		        	var tempi = ((eve.x - basewidth) / size);
		        	var tempj = ((eve.y - baseheight) / size);
		        	cola.push(grillaSprites[(10 * tempi) + tempj]);
		        	iguales.push(grillaSprites[(10 * tempi) + tempj]);
		        	while(cola.length != 0){
		        		temp = cola.pop();
		        		tempi = ((temp.x - basewidth) / size);
		        		tempj = ((temp.y - baseheight) / size);
		        		valor = grilla[(10 * tempi) + tempj];
		        		if(tempi > 0 && grilla[(10 * (tempi - 1)) + tempj] == valor){
		        			grilla[(10 * (tempi - 1)) + tempj] = parseInt(Math.random() * 3);
		        		}
		        	}
		        }
		    };
    	</script>
    </body>
</html>